"use strict";(()=>{var e={};e.id=214,e.ids=[214],e.modules={46517:e=>{e.exports=require("lodash")},59283:e=>{e.exports=require("lodash/at")},20770:e=>{e.exports=require("lodash/clone")},39131:e=>{e.exports=require("lodash/compact")},48390:e=>{e.exports=require("lodash/extend")},9368:e=>{e.exports=require("lodash/filter")},22265:e=>{e.exports=require("lodash/first")},41238:e=>{e.exports=require("lodash/includes")},35599:e=>{e.exports=require("lodash/isArray")},89699:e=>{e.exports=require("lodash/isEmpty")},25716:e=>{e.exports=require("lodash/isFunction")},27078:e=>{e.exports=require("lodash/isNumber")},75795:e=>{e.exports=require("lodash/isObject")},15452:e=>{e.exports=require("lodash/isPlainObject")},97026:e=>{e.exports=require("lodash/isString")},22133:e=>{e.exports=require("lodash/isUndefined")},83824:e=>{e.exports=require("lodash/last")},53707:e=>{e.exports=require("lodash/map")},11516:e=>{e.exports=require("lodash/take")},11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},71017:e=>{e.exports=require("path")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},33717:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>S,originalPathname:()=>D,patchFetch:()=>_,requestAsyncStorage:()=>v,routeModule:()=>y,serverHooks:()=>b,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>P});var o={};r.r(o),r.d(o,{POST:()=>q});var a=r(95419),n=r(69108),s=r(99678),i=r(74471);r(68616);var l=r(78070);r(80424);var d=r(25142),u=r(45248),p=r(76386),c=r(66864),h=r(42053);function m(e){return e.replace(/[\r\n]/g,"")}function g(e){let t,r="",o="",a=/\d+/g;for(;null!==(t=a.exec(e));)(o=t[0]).length>r.length&&(r=o);return r}function f(e){return e.length<=0||e.every(t=>t===e[0])}function x(e,t,r,o){let a=e.split(t).reverse();for(let e=0;e<o;e++)a.length>1&&(a[0]=a[0]+r+a[1],a.splice(1,1));return a.reverse().join("")}p.v2.config({cloud_name:"dntylhu7k",secure:!0,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});let q=async(e,t)=>{if("POST"!==e.method)return console.log(e.method),l.Z.json({error:"Method Not Alloweddddd"});try{let t=await e.formData(),o=t.get("file"),a=t.get("id"),n=t.get("url"),s=t.get("text");if(!o)return console.log("No file uploaded"),l.Z.json({message:"No file uploaded"});let i=await o.arrayBuffer();try{(0,d.P)();let e=new Uint8Array(i);if(Buffer.from(e).toString("base64"),""!=n){let e=n.split("/"),t=e[e.length-1].slice(0,-4);await p.v2.api.delete_resources([t],{type:"upload",resource_type:"image"})}let t=(await new Promise((t,r)=>{p.v2.uploader.upload_stream({resource_type:"auto"},(e,o)=>{if(e){console.error("Cloudinary upload error:",e),r(e);return}t(o)}).end(e)})).secure_url;await u.Gw.findByIdAndUpdate(a,{bol:t})}catch(e){throw console.error("Error caught in try-catch:",e),Error("Falhou ao fazer o upload do boleto")}let h=function(e){let t=e.replace(/ /g,"").replace(/\./g,""),r=(t=(t=t.replace(/\â€”/g,"")).replace(/\-/g,"")).split("\n"),o=r[0];for(let e of r)g(e).length>g(o).length&&(o=e);return 47==g(o).length||48==g(o).length?g(o):50==g(o).length?g(o).substring(3):g(o).length>=51?g(o).slice(-47):"Codigo nao encontrado"}(s),q=function(e){let t=/^[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{2,4}$/,r=e.split(" ");console.log(r=(r=r.filter(e=>""!==e&&" "!==e)).map(m));let o=[];return(r.forEach((e,a)=>{["Vencimento","vencimento","Vencinento","vencinento"].some(t=>e.includes(t))&&r.slice(a).some(e=>!!t.test(e)&&(o.push(e),!0))}),f(o)&&0!==o.length||(o=[],r.forEach((e,a)=>{["Vencimento","vencimento","Vencinento","vencinento"].includes(e)&&r.slice(a).some(e=>!!t.test(e)&&(o.push(e),!0))})),f(o)&&o.length>0)?o[0]:"ERROR-DATE"}(s);if(console.log(q),"ERROR-DATE"!=q){let e=q.split("/");2===e[2].length&&(e[2]="20"+e[2]);var r=new Date(`${e[2]}-${e[1]}-${e[0]}`)}let y=function(e){let t=/^[0-9]+.{1,25}\,[0-9]{1,2}$/,r=e.split(" ");r=r.filter(e=>""!==e&&" "!==e);let o=[];for(let e=0;e<r.length;e++){let a=r[e];if(a.includes("Valor")||a.includes("valor"))for(let a=e+1;a<r.length;a++){let e=r[a];if(t.test(e)){o.push(e);break}}}if(!f(o)||0===o.length){o=[];for(let e=0;e<r.length;e++){let a=r[e];if(a.includes("Pagar")||a.includes("pagar")||a.includes("Cobrado")||a.includes("cobrado"))for(let a=e+1;a<r.length;a++){let e=r[a];if(t.test(e)){o.push(e);break}}}}if(f(o)&&0!==o.length){let e=o[0],t=x(e,".","",e.split(".").length-1);return t=parseFloat(t=x(t,",",".",t.split(",").length-1)).toFixed(2)}{let e=o.map(e=>x(e,".","",e.split(".").length-1));return e=parseFloat(Math.max(...(e=e.map(e=>x(e,",",".",e.split(",").length-1))).map(e=>parseFloat(e)))).toFixed(2)}}(s);return(0,d.P)(),await u.Gw.findByIdAndUpdate(a,{scd:h}),"ERROR-DATE"!=q&&await u.Gw.findByIdAndUpdate(a,{due_date:r}),y!=-1/0&&await u.Gw.findByIdAndUpdate(a,{total:y}),(0,c.revalidatePath)("/contas"),(0,c.revalidatePath)("/contas/pagas"),(0,c.revalidatePath)("/contas/contas_a_pagar"),(0,c.revalidatePath)("/contas/variadas"),l.Z.json({ddd:""})}catch(e){return console.error("Error processing the request :( :",e),l.Z.json({message:"Error processing the request",error:e})}};(0,h.h)([q]),(0,i.U)("adbf448f44569ab21e9ef2dcd563270f7401b763",q);let y=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/UploadDef/route",pathname:"/api/UploadDef",filename:"route",bundlePath:"app/api/UploadDef/route"},resolvedPagePath:"C:\\Users\\nicol\\OneDrive\\Documentos\\JS\\Projects\\inovdrop true\\app\\api\\UploadDef\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:b,headerHooks:S,staticGenerationBailout:P}=y,D="/api/UploadDef/route";function _(){return(0,s.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:w})}},45248:(e,t,r)=>{r.d(t,{Gb:()=>c,Gw:()=>u,Z0:()=>p,n5:()=>d});var o=r(11185),a=r.n(o);let n=new(a()).Schema({name:{type:String,required:!0,min:3,max:25},email:{type:String,required:!0},password:{type:String,required:!0}}),s=new(a()).Schema({name:{type:String,required:!0,min:3,max:25,default:"Nome n\xe3o adicionado"},type:{type:String,required:!0},pag:{type:Boolean,required:!0,default:!1},scd:{type:String,default:"Sem Codigo DD"},due_date:{type:Date,default:new Date(1e3,11,11)},pag_date:{type:Date,default:new Date(1e3,11,11)},total:{type:Number,min:0,default:0},bol:{},comp:{},user_id:{}},{timestamps:!0}),i=new(a()).Schema({name:{type:String,required:!0,min:3,max:25}}),l=new(a()).Schema({name:{type:String,required:!0,min:3,max:25}}),d=a().models.User||a().model("User",n),u=a().models.Contssss||a().model("Contssss",s),p=a().models.FixNames||a().model("FixNames",i),c=a().models.ForName||a().model("ForName",l)},25142:(e,t,r)=>{r.d(t,{P:()=>n});var o=r(11185),a=r.n(o);let n=async()=>{let e={};try{if(e.isConnected)return;let t=await a().connect("mongodb+srv://Nicolas:8M3ZyNwblZhpOkHf@cluster0.299js7c.mongodb.net/contas?retryWrites=true&w=majority");e.isConnected=t.connections[0].readyState}catch(e){throw console.log(e),Error(e)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[893,60,446],()=>r(33717));module.exports=o})();